# Instructions

## 初始化项目
这个项目主要功能是 claude agent sdk, 让用户可以很方便的围绕一个 repo 来添加新的功能。请把这个 Rust 项目转换成一个 workspace，里面包含 crates/gba-core (core execute engine), crates / gba-pm (prompt manager)，以及 apps/gba-cli (command line interface)。生成的是一个 gba cli。所有的 deps 放在 workspace 下，各个 crate 通过 `xx = { workspace = true }` 来引用。CLI 使用 clap / ratatui 来构建。prompt manager 使用 minijinja 来构建。core execute engine 使用 tokio / claude-agent-sdk-rs 0.6 来构建。所有的 deps 都要使用最新版本

先不要撰写代码，生成各个 crate 的 skeletong 即可

不要使用 derive_builder 使用 typed_builder

## 生成设计文档
根据图片 ./.chats/images/design0.png 和 ./.chats/images/design1.png ，生成设计文档：

- 包括核心架构的 ascii diagram，以及重要的流程
- 各个 crate 有清晰的职责和 public interface
- gba-core: 核心的执行引擎，根据不同场景下的 prompt，调用 claude agent sdk 来执行任务。务必提供非常精简可用的接口
- gba-pm: 提示词管理器，负责加载、渲染、管理提示词。务必提供非常精简可用的接口
- gba-cli: 命令行界面，负责与用户交互，并调用 gba-core 来执行任务。
- 代码结构尽可能职责单一，不要出现重复代码，follow SOLID principles，尽可能使用 Rust 的最新特性。
- 提供开发计划，包括每个阶段的任务。

设计文档放在 ./specs 下合适的位置

## 更新设计文档

1. .gba/config.yaml 添加 permission_mode 字段 (auto | manual | none)，不用配置最大 token 数量，都是无限制的。
2. FeatureStatus 应该还有 verification
3. 任务执行结果应该记录 turns，放在 feature.yaml 中，最后的 PR link 也放进去。
4. 在 gba run 过程中，如果中断，下次运行可以继续恢复（在提示词里体现）。
5. 预先思考好所有场景下的提示词，放在 crates/gba-pm/templates 下，我来 review。提示词用英文

请更新 design spec

## 更新提示词
注意 init 的提示词应该还要生成 .gba / .trees 等目录，以及更改 .gitignore；run/execute 的提示词最后要使用 gh cli 生成 pull request 并且提供详尽的 PR description.
